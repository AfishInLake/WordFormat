# 常见问题

本文档汇总了使用 WordFormat 过程中常见的问题及解决方案，帮助您快速排查和解决遇到的问题。

## 命令行使用问题

### Q1：命令行执行报参数解析错误？

**核心原因**：参数顺序错误，未遵循「全局参数 → 子命令 → 子命令专属参数」规则

**错误示例**：子命令参数（`-c`）放在子命令前面
```bash
wordformat -d doc.docx -c config.yaml apply-format -jf output/doc.json
```

**正确示例**：先全局参数，再子命令，最后子命令参数
```bash
wordformat -d doc.docx -jf output/doc.json apply-format -c config.yaml
```

### Q2：generate-json 模式报 JSON 文件不存在？

**原因**：`--json/-jf` 为全局必填参数，该模式下仅作**参数占位**，无需提前创建JSON文件，工具会自动生成

**解决**：直接指定JSON保存路径即可，工具会自动创建文件及上级目录，示例：
```bash
wordformat -d doc.docx -jf output/未创建的json文件.json generate-json -c config.yaml
```

### Q3：check-format/apply-format 模式报 JSON 文件不存在？

**排查方向**：
1. 确认 `--json/-jf` 指定的是**完整JSON文件路径**，而非目录
2. 检查JSON路径拼写是否正确（区分大小写，Windows系统注意反斜杠/正斜杠）
3. 确认已执行 `generate-json` 模式生成JSON，或手动创建了合法的JSON文件

### Q4：命令行工具不可用或报「命令未找到」？

**排查方向**：
1. 检查是否在虚拟环境中安装
2. 确保安装时使用了 `-e` 选项（editable mode）
3. 检查系统 PATH 是否包含了 Python 的脚本目录
4. 尝试使用 `python -m wordformat` 命令替代 `wordformat`

## 文档处理问题

### Q5：JSON 文件生成失败？

**排查方向**：
1. 确认待处理Word文档路径正确，文件未损坏、可正常打开
2. 确保Word文档内容完整，无空文档或特殊字符导致的解析失败
3. 检查配置文件（`-c`）路径正确，YAML格式合法无语法错误

### Q6：格式校验/格式化无效果、未生成批注/修正？

**排查方向**：
1. 检查JSON文件中各段落的 `category` 字段是否正确（标题/正文/摘要等是否识别准确）
2. 确认配置文件（YAML）中的规则项无拼写错误（如字体名称、对齐方式）
3. 检查Word文档的段落/字符是否有特殊格式（如手动换行/分节符）导致的解析异常
4. 验证配置文件中的规则是否与文档实际格式一致（无违规则不会生成批注/修正）

### Q7：执行后生成的Word文档无法打开？

**排查方向**：
1. 确认使用的是 Python 3.11+ 版本，避免版本兼容问题
2. 检查待处理Word文档为 `.docx` 格式，不支持 `.doc` 旧格式
3. 确保生成的JSON文件语法合法，手动修改后未出现JSON格式错误（如缺少逗号/引号）
4. 检查输出目录权限是否足够，确保工具能够写入文件

### Q8：文档结构识别不准确？

**排查方向**：
1. 检查文档内容是否清晰，标题层级是否明确
2. 尝试使用不同的配置模板，可能当前模板不适合您的文档结构
3. 手动调整生成的JSON文件，修正识别错误的段落类型
4. 检查文档中是否有特殊格式或隐藏字符影响识别

## 环境配置问题

### Q9：依赖安装失败？

**排查方向**：
1. 确保 Python 版本为 3.11+
2. 尝试更新 pip 到最新版本：`pip install --upgrade pip`
3. 检查网络连接，确保能够访问 PyPI
4. 尝试使用 uv 代替 pip 安装依赖：`make install`

### Q10：API 服务启动失败？

**排查方向**：
1. 检查 `.env` 文件中的配置是否正确
2. 确保端口未被其他服务占用
3. 查看服务启动日志，获取详细错误信息

### Q11：构建.exe程序失败？

**排查方向**：
1. 确保所有依赖已正确安装
2. 检查系统是否安装了必要的构建工具
3. 查看构建日志，获取详细错误信息
4. 尝试在干净的虚拟环境中重新构建

## Git 相关问题

### Q12：为什么使用 SSH 推送时 Git LFS 会卡住或失败？

**排查方向**：
1. GitHub **不支持通过 SSH 协议上传 Git LFS 文件**。
虽然普通代码可以通过 `git@github.com` 正常推送，但 LFS 在 SSH 模式下会尝试执行 `git-lfs-transfer` 命令，而 GitHub 的 SSH 服务并不识别该命令，导致连接被立即关闭（报错如 `EOF` 或 `Unable to negotiate version`）。

**正确做法**：
- 将远程仓库地址改为 **HTTPS**：
  ```bash
  git remote set-url origin https://github.com/AfishInLake/WordFormat.git
  ```
- 使用 **Personal Access Token (PAT)** 作为密码（非 GitHub 登录密码）
- 确保网络能访问 GitHub（国内用户若遇 LFS 上传慢/失败，可考虑配合代理或使用 Gitee 托管 LFS）

> 💡 提示：只要远程地址是 `git@github.com:...`，Git LFS **一定无法上传成功**——这是 GitHub 的设计限制，非配置错误。

### Q13：Git 提交时出现大量变更文件？

**排查方向**：
1. 检查 `.gitignore` 文件是否正确配置，排除了不必要的文件
2. 避免提交生成的临时文件和输出文件
3. 只提交源代码和配置文件，不提交测试数据和大模型文件

## 性能问题

### Q14：处理大文档时速度很慢？

**排查方向**：
1. 检查文档大小，对于特别大的文档可能需要更长时间
2. 确保系统资源充足，特别是内存和CPU
3. 检查网络连接，若使用远程LLM模型，网络延迟可能影响速度
4. 尝试使用本地模型或优化模型配置，减少网络请求

### Q15：内存占用过高导致程序崩溃？

**排查方向**：
1. 尝试处理较小的文档，逐步测试工具的处理能力
2. 调整批量处理大小，减少单次处理的段落数量
3. 确保系统有足够的内存，对于大文档可能需要 8GB+ 内存
4. 检查是否有内存泄漏问题，尝试重启程序后再处理

## 其他问题

### Q16：工具支持哪些版本的 Word 文档？

**支持的格式**：
- 仅支持 `.docx` 格式的 Word 文档
- 不支持 `.doc` 旧格式，需要先将 `.doc` 转换为 `.docx` 格式

### Q17：工具支持哪些操作系统？

**支持的操作系统**：
- Windows
- macOS
- Linux

### Q18：如何获取更多帮助？

**支持渠道**：
1. 查看项目文档：`docs/` 目录下的详细文档
2. 提交 Issue：在 GitHub 仓库提交问题，获取社区支持
3. 联系邮箱：1593699665@qq.com

### Q19：如何报告 bug 或提出新功能建议？

**建议步骤**：
1. 先查看现有 Issue，确认问题是否已被报告
2. 提交新 Issue，详细描述问题或建议
3. 提供必要的信息，如操作系统、Python 版本、错误信息等
4. 如有可能，提供复现步骤和示例文档

### Q20：工具是否收费？

**回答**：WordFormat 是一个开源项目，基于 MIT 许可证发布，完全免费使用。您可以自由修改和分发代码，只要保留原作者声明。
